<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>de.metas.endcustomer.mf15</groupId>
		<artifactId>de.metas.endcustomer.mf15</artifactId>
		<version>1.0_IT-SNAPSHOT</version>
	</parent>

	<artifactId>de.metas.endcustomer.mf15.ear</artifactId>
	<packaging>ear</packaging>

	<description></description>

	<dependencies>
		
		<!-- the skinny war of de.metas.endcustomer.mf15.zkwebui, only including the classes that were inside the project itself -->
		<dependency>
			<groupId>de.metas.endcustomer.mf15</groupId>
			<artifactId>de.metas.endcustomer.mf15.zkwebui</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		<!-- required, because de.metas.endcustomer.mf15.zkwebui is a skinny war -->
		<dependency>
			<groupId>de.metas.endcustomer.mf15</groupId>
			<artifactId>de.metas.endcustomer.mf15.base</artifactId>
			<version>${project.version}</version>
		</dependency>

		<dependency>
			<groupId>de.metas.swat</groupId>
			<artifactId>de.metas.swat.zkwebui</artifactId>
		</dependency>

		<!-- the skinny war of de.metas.endcustomer.mf15.serverRoot, only including the classes that were inside the project itself -->
		<dependency>
			<groupId>de.metas.endcustomer.mf15</groupId>
			<artifactId>de.metas.endcustomer.mf15.serverRoot</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		<!-- required, because de.metas.endcustomer.mf15.serverRoot is a skinny war -->
		<dependency>
			<groupId>de.metas.adempiere.adempiere</groupId>
			<artifactId>de.metas.adempiere.adempiere.serverRoot.webui</artifactId>
			<version>${project.version}</version>
		</dependency>

		<!-- the skinny war of de.metas.report.jasper.server, only including the classes that were inside the project itself -->
		<dependency>
			<groupId>de.metas.report.jasper.server</groupId>
			<artifactId>de.metas.report.jasper.server.war</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		<!-- required, because de.metas.report.jasper.server.base is a skinny war -->
		<dependency>
			<groupId>de.metas.report.jasper.server</groupId>
			<artifactId>de.metas.report.jasper.server.base</artifactId>
			<version>${project.version}</version>
		</dependency>

		<!-- Thx for the two fonts to http://ansuz.sooke.bc.ca/page/fonts ^^ -->
		<!--  required for the server-side jasper -->
		<dependency>
			<groupId>jp.osdn.ocra</groupId>
			<artifactId>jp.osdn.ocra</artifactId>
		</dependency>
		<dependency>
			<groupId>jp.osdn.ocrb</groupId>
			<artifactId>jp.osdn.ocrb</artifactId>
		</dependency>

	</dependencies>

	<build>
		<plugins>
			<plugin>
				<artifactId>maven-ear-plugin</artifactId>
				<version>2.9</version>
				<configuration>
					<!-- 
						line 1: exclude jars that are already available somewhere else in jboss. If we don't exclude them, there will be strange ClassCastExceptions
						   for more info, check this http://docs.jboss.org/jbossas/jboss4guide/r1/html/ch2.chapter.html#d0e2329
						line 2: exclude all zips, because we don't need them in the ear
						line 3: make sure that jbossall-client is not in the ear. Otherwise, things like    
						   "java.lang.IncompatibleClassChangeError: Class org.jnp.server.NamingServer does not implement the requested interface org.jnp.interfaces.Naming"
						   will happen and jboss won't deploy the ear (see https://community.jboss.org/thread/64703?tstart=0)
					-->
					<packagingExcludes>
						**/servlet-api*.jar,**/xercesImpl*.jar,**/xmlParserAPIs*.jar,**/xml-apis*.jar,
						**/*.zip,
						**/jbossall-client*.jar,
					</packagingExcludes>
					<defaultJavaBundleDir>lib/</defaultJavaBundleDir>

<!-- 
I think this parameter would manipulate the wars' manifests' classpath. however, that classpath is already fine as it is, because those jars are already skinny
In particular, it contains the "fixed" snapshot versions like "de.metas.adempiere.adempiere.patched-ecs-1.0_it-20140416.160124-8.jar". 
This is also how the instrumented jars in the de.metas.endcustomer.mf15.aopc zip file are named 
					<skinnyWars>true</skinnyWars>
-->
					<!-- deal with zips as we would deal with jars; 
					we need to do this because otherwise the plugin would abort the build due to our de.metas.endcustomer.mf15.aopc.zip -->
					<artifactTypeMappings>
						<artifactTypeMapping type="zip" mapping="jar" />
					</artifactTypeMappings>

					<modules>
					
						<!-- Disable WebUI (see task 09516)
						<webModule>
							<groupId>de.metas.endcustomer.mf15</groupId>
							<artifactId>de.metas.endcustomer.mf15.zkwebui</artifactId>
							<contextRoot>/webui</contextRoot>
						</webModule>
						-->

						<webModule>
							<groupId>de.metas.endcustomer.mf15</groupId>
							<artifactId>de.metas.endcustomer.mf15.serverRoot</artifactId>
							<contextRoot>/admin</contextRoot>
						</webModule>

						<webModule>
							<groupId>de.metas.report.jasper.server</groupId>
							<artifactId>de.metas.report.jasper.server.war</artifactId>
							<contextRoot>/adempiereJasper</contextRoot>
						</webModule>
					</modules>
				</configuration>
			</plugin>
		</plugins>
	</build>
</project>
