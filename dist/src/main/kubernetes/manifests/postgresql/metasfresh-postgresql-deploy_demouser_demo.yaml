apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: "metasfresh-postgresql-demouser-demo"
  labels:
    de.metas.deployment.type: metasfresh-postgresql
    de.metas.deployment.user: "demouser"
    de.metas.deployment.stage: "demo"
    de.metas.deployment.name: "metasfresh-postgresql-demouser-demo"
  namespace: "default"
# can be created with kubectl create namespace demo"
#  namespace: "demo"
spec:
  replicas: 1
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        de.metas.deployment.type: metasfresh-postgresql
        de.metas.deployment.user: "demouser"
        de.metas.deployment.stage: "demo"
    spec:
      containers:
#
# metasfresh-db
      - name: db
        image: docker.metasfresh.com/postgres:10.3
        imagePullPolicy: Always
        ports:
          - containerPort: 5432
        resources: {}
        volumeMounts:
        - mountPath: /etc/localtime
          name: host-localtime
          readOnly: true
        - mountPath: /etc/timezone
          name: host-timezone
          readOnly: true
        - mountPath: /var/lib/postgresql/data
          name: postgresql-data
      initContainers:
        - name: init-postgres
          image: docker.metasfresh.com/metasfresh/metasfresh-db-init-pg-10-3:gh18_dist_LATEST
          imagePullPolicy: Always
          env:
          - name: DEBUG_PRINT_BASH_CMDS
            value: "n"
#          - name: URL_MIGRATION_SCRIPTS_PACKAGE
#            value: "https://repo.metasfresh.com/content/repositories/mvn-gh18-dist-releases/de/metas/dist/metasfresh-dist-dist/5.54.2-89+gh18dist/metasfresh-dist-dist-5.54.2-89+gh18dist-sql-only.tar.gz"
          volumeMounts:
          - name: host-localtime
            mountPath: /etc/localtime
            readOnly: true
          - name: host-timezone
            mountPath: /etc/timezone
            readOnly: true
          - mountPath: /var/lib/postgresql/data
            name: postgresql-data
      volumes:
      - name: host-localtime
        hostPath:
          path: /etc/localtime
      - name: host-timezone
        hostPath:
          path: /etc/timezone
      - name: postgresql-data
        emptyDir: {}
