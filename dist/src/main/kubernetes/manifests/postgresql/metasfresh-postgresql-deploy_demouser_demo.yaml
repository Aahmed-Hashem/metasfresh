apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: "metasfresh-postgresql-demouser-demo"
  labels:
    de.metas.deployment.type: metasfresh-postgresql
    de.metas.deployment.user: "demouser"
    de.metas.deployment.stage: "demo"
    de.metas.deployment.name: "metasfresh-postgresql-demouser-demo"
  namespace: "default"
spec:
  replicas: 1
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        de.metas.deployment.type: metasfresh-postgresql
        de.metas.deployment.user: "demouser"
        de.metas.deployment.stage: "demo"
    spec:
      containers:
#
# metasfresh-db
      - name: db
        image: docker.metasfresh.com/postgres:10.3
        imagePullPolicy: Always
        ports:
          - containerPort: 5432
        resources: {}
        volumeMounts:
        - mountPath: /etc/localtime
          name: host-localtime
          readOnly: true
        - mountPath: /etc/timezone
          name: host-timezone
          readOnly: true
        - mountPath: /var/lib/postgresql/data
          name: postgresql-data
      initContainers:
        - name: init-postgres
          image: docker.metasfresh.com/metasfresh/metasfresh-db-init-pg-10-3:master_LATEST
          imagePullPolicy: Always
          env:
          - name: DEBUG_PRINT_BASH_CMDS
            value: "n"
          - name: URL_SEED_DUMP
            value: "https://metasfresh.com/wp-content/releases/db_seeds/metasfresh_latest.pgdump"
          # apply the latest master build's migration scripts
          - name: URL_MIGRATION_SCRIPTS_PACKAGE
            value: "https://repo.metasfresh.com/service/local/artifact/maven/redirect?g=de.metas.dist&a=metasfresh-dist-dist&v=LATEST&r=mvn-master&p=tar.gz&c=sql-only"
          volumeMounts:
          - name: host-localtime
            mountPath: /etc/localtime
            readOnly: true
          - name: host-timezone
            mountPath: /etc/timezone
            readOnly: true
          - mountPath: /var/lib/postgresql/data
            name: postgresql-data
      volumes:
      - name: host-localtime
        hostPath:
          path: /etc/localtime
      - name: host-timezone
        hostPath:
          path: /etc/timezone
      - name: postgresql-data
        emptyDir: {}
